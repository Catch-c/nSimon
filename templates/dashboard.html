<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>NSimon | Student Dashboard</title>
    <!-- Bootstrap & CSS -->
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" rel="stylesheet" />
    <script crossorigin="anonymous" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">

    <!-- FavIcon -->
    <link href="{{ url_for('static', filename='favicon/apple-touch-icon.png') }}" rel="apple-touch-icon"
        sizes="180x180" />
    <link href="{{ url_for('static', filename='favicon/favicon-32x32.png') }}" rel="icon" sizes="32x32"
        type="image/png" />
    <link href="{{ url_for('static', filename='favicon/favicon-16x16.png') }}" rel="icon" sizes="16x16"
        type="image/png" />
    <link href="{{ url_for('static', filename='favicon/site.webmanifest') }}" rel="manifest" />
    <link color="#5bbad5" href="{{ url_for('static', filename='favicon/safari-pinned-tab.svg') }}" rel="mask-icon" />
    <meta content="#da532c" name="msapplication-TileColor" />
    <meta content="#3a3a3a" name="theme-color" />

</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
    @import url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css");
</style>

<body id="MainBody">
    <!-- NavBar & Sidebar -->
    <nav class="navbar" style="border-bottom: 2px solid red;">
        <div class="container-fluid">
            <span class="navbar-brand h4">

                <!-- This will be hidden on mobile -->
                <a href="/" style="text-decoration: none; color: inherit;">
                    <div class="d-none d-md-inline greeting">
                        Good evening, <span id="yourName">Placeholder Jones</span><span
                            style="margin-right: 10px;">.</span>
                    </div>
                </a>

                <!-- This will always be visible -->
                <span class="greetingTime" style="font-size:large;">
                    <span id="currentDate">1/01/2023</span>
                    <span id="currentTime">0:00AM</span>
                </span>

            </span>

            <button class="btn" id="hamburgerBtn" style="color: white;">
                <i class="bi bi-list hamburgerMenu"></i>

            </button>
        </div>
    </nav>

    <div class="sidebar">
        <button class="closeBtn">&times;</button>

        <div class="links-section">
            <a href="/" class="sidebarLink">Home</a>
            <a href="/settings" class="sidebarLink">Settings</a>
            <a href="https://discord.gg/yDRndGT5G9" class="sidebarLink">Discord (Support)</a>
            <a href="/support" class="sidebarLink">Support</a>
            <a href="/logout" class="sidebarLink">Logout</a>
        </div>

        <div class="school-links-section">
            <br>
            <span class="sidebarTitle">School Links</span><br>

            <span class="sidebarSubtitle">General Resources</span><br>
            <a href="https://simon.sfx.vic.edu.au/" class="sidebarSchoolLink">‚Ä¢ SIMON</a><br>
            <a href="https://www.sfxcareers.com.au/" class="sidebarSchoolLink">‚Ä¢ Careers</a><br>
            <a href="https://shop.sfx.vic.edu.au/mymonitor/" class="sidebarSchoolLink">‚Ä¢ CDF Pay</a><br>
            <a href="http://bea-v-print-01:9191/app" class="sidebarSchoolLink">‚Ä¢ WebPrint</a><br><br>

            <span class="sidebarSubtitle">College Links</span><br>
            <a href="https://simon.sfx.vic.edu.au/WebHandlers/DownloadKnowledgeBankDocument.ashx?DocID=19761&KBankID=11"
                class="sidebarSchoolLink">‚Ä¢ 2022 Yearbook</a><br>
            <a href="https://simon.sfx.vic.edu.au/WebHandlers/DownloadKnowledgeBankDocument.ashx?DocID=14283&KBankID=25&UserID=25"
                class="sidebarSchoolLink">‚Ä¢ College Awards/Colours</a><br>
            <a href="https://simon.sfx.vic.edu.au/WebHandlers/DownloadKnowledgeBankDocument.ashx?DocID=21040&KBankID=25&UserID=25"
                class="sidebarSchoolLink">‚Ä¢ 2024 Beaconsfield Leadership</a><br>
            <a href="https://simon.sfx.vic.edu.au/WebHandlers/DownloadKnowledgeBankDocument.ashx?DocID=18795&KBankID=25&UserID=25"
                class="sidebarSchoolLink">‚Ä¢ 2024 Berwick/Officer Leadership</a><br>
            <a href="https://saml-in3.clickview.com.au/Shibboleth.sso/STF1792" class="sidebarSchoolLink">‚Ä¢
                Clickview</a><br>

        </div>
    </div>

    <script>
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const sidebar = document.querySelector('.sidebar');
        const closeBtn = document.querySelector('.closeBtn');

        hamburgerBtn.addEventListener('click', function () {
            sidebar.style.right = "0";
        });

        closeBtn.addEventListener('click', function () {
            sidebar.style.right = "-300px";
        });

        // If clicking outside the sidebar
        document.addEventListener('click', function (event) {
            if (!sidebar.contains(event.target) && !hamburgerBtn.contains(event.target)) {
                sidebar.style.right = "-300px";
            }
        });

    </script>

    <div class="mainBody container-fluid h-100">
        <div class="row h-100 ps-2 pt-3">
            <div class="col-md-3 col-12p-3 order-2 order-md-1">

                <!-- Weather -->
                <div class="big-box rounded p-3 mb-2">
                    <h4 class="pageSubtitle" style="font-weight: 600;">Weather <span style="font-size:medium;"
                            id="weatherCampus" class="pageSubtitleSub">Berwick</span>
                    </h4>
                    <div class="small-box rounded p-3 mb-2">
                        <span class="class-name" id="currentWeather">Loading¬∞</span>
                        <span class="time" id="upcomingWeather">Loading¬∞ | Loading¬∞ | Loading¬∞</span>
                        <div class="teacher-name" id="weatherInformation">‚òÄÔ∏è Loading | üåë Loading | üåßÔ∏è Loading</div>
                    </div>
                </div>

                <!-- Class Resources -->
                <div class="big-box rounded p-3 mb-2">
                    <h4 class="pageSubtitle" style="font-weight: 600;">Class Resources
                    </h4>

                    <!-- Due -->
                    <div class="small-box rounded p-3 mb-2" id="dueTasksBox" style="position: relative;">
                        <span class="color-dot bg-primary me-2"></span>
                        <span class="class-name" id="dueTasks">0 Due</span>
                        <i class="arrow bi bi-arrow-down-circle" style="position: absolute; right: 10px;"></i>
                        <div style="display: none" id="dueTasksExpand">
                        </div>
                    </div>
                    <script>
                        $(document).ready(function() {
                            $('#dueTasksBox').on('click', function() {
                                var dueTasksExpand = $('#dueTasksExpand');
                                var arrow = $(this).find('.arrow');

                                if (dueTasksExpand.css('display') === 'none') {
                                    dueTasksExpand.css('display', 'block');

                                    arrow.removeClass('bi-arrow-down-circle');
                                    arrow.addClass('bi-arrow-up-circle');

                                    setTimeout(() => {
                                        dueTasksExpand.addClass('visible');
                                    }, 1); // small delay to allow for display:block to take effect
                                } else {
                                    dueTasksExpand.removeClass('visible');
                                    arrow.removeClass('bi-arrow-up-circle');
                                    arrow.addClass('bi-arrow-down-circle');
                                    setTimeout(() => {
                                        dueTasksExpand.css('display', 'none');
                                    }, 300); // delay to allow for the fade out transition to complete
                                }
                            });
                        });

                        
                    </script>

                    <!-- Overdue -->
                    <div class="small-box rounded p-3 mb-2" id="overdueTasksBox" style="position: relative;">
                        <span class="color-dot bg-danger me-2"></span>
                        <span class="class-name" id="overdueTasks">0 Overdue</span>
                        <i class="arrow bi bi-arrow-down-circle" style="position: absolute; right: 10px;"></i>
                        <div style="display: none" id="overdueTasksExpand">
                        </div>
                    </div>
                    <script>
                        $(document).ready(function() {
                            $('#overdueTasksBox').on('click', function() {
                                var dueTasksExpand = $('#overdueTasksExpand');
                                var arrow = $(this).find('.arrow');

                                if (dueTasksExpand.css('display') === 'none') {
                                    dueTasksExpand.css('display', 'block');

                                    arrow.removeClass('bi-arrow-down-circle');
                                    arrow.addClass('bi-arrow-up-circle');

                                    setTimeout(() => {
                                        dueTasksExpand.addClass('visible');
                                    }, 1); // small delay to allow for display:block to take effect
                                } else {
                                    dueTasksExpand.removeClass('visible');
                                    arrow.removeClass('bi-arrow-up-circle');
                                    arrow.addClass('bi-arrow-down-circle');
                                    setTimeout(() => {
                                        dueTasksExpand.css('display', 'none');
                                    }, 300); // delay to allow for the fade out transition to complete
                                }
                            });
                        });

                        
                    </script>

                    <!-- Results -->
                    <div class="small-box rounded p-3 mb-2" id="resultTasksBox" style="position: relative;">
                        <span class="color-dot bg-success me-2"></span>
                        <span class="class-name" id="resultTasks">0 Results</span>
                        <i class="arrow bi bi-arrow-down-circle" style="position: absolute; right: 10px;"></i>
                        <div style="display: none" id="resultTasksExpand">
                        </div>
                    </div>
                    <script>
                        $(document).ready(function() {
                            $('#resultTasksBox').on('click', function() {
                                var dueTasksExpand = $('#resultTasksExpand');
                                var arrow = $(this).find('.arrow');

                                if (dueTasksExpand.css('display') === 'none') {
                                    dueTasksExpand.css('display', 'block');

                                    arrow.removeClass('bi-arrow-down-circle');
                                    arrow.addClass('bi-arrow-up-circle');

                                    setTimeout(() => {
                                        dueTasksExpand.addClass('visible');
                                    }, 1); // small delay to allow for display:block to take effect
                                } else {
                                    dueTasksExpand.removeClass('visible');
                                    arrow.removeClass('bi-arrow-up-circle');
                                    arrow.addClass('bi-arrow-down-circle');
                                    setTimeout(() => {
                                        dueTasksExpand.css('display', 'none');
                                    }, 300); // delay to allow for the fade out transition to complete
                                }
                            });
                        });

                        
                    </script>
                    
                </div>

                <!-- Today -->
                <div class="big-box rounded p-3 mb-2">
                    <h4 class="pageSubtitle" style="font-weight: 600;">Today <span style="font-size:medium;"
                            id="todayDate" class="pageSubtitleSub">LOADING</span>
                    </h4>
                    <div id="todayActivities">
                    </div>
                </div>

            </div>

            <!-- Daily Messages -->
            <div class="col-md-6 col-12p-3 order-3 order-md-2">
                <div class="big-box rounded p-3 mb-2">
                    <h4 class="pageSubtitle" style="font-weight: 600;">Daily Messages <span style="font-size:medium;"
                            id="totalDailyMessages" class="pageSubtitleSub">LOADING...</span>
                    </h4>
                    <div class="messages-container rounded p-3" id="dailyMessages" style="overflow-y:scroll;">


                        <div class="small-box rounded p-3 mb-2" id="dailyMessagesLoading">
                            <span class="color-dot bg-danger me-2"></span>
                            <span class="class-name">Loading</span>
                            <div class="teacher-name">Your daily messages are loading...</div>
                        </div>

                    </div>
                </div>

            </div>

            <!-- Timetable -->
            <div class="col-md-3 col-12p-3 order-1 order-md-3">



                <div class="big-box rounded p-3 mb-2">

                    <h4 class="pageSubtitle" style="font-weight: 600;">Timetable
                        <button id="prevDay" class="btn btn-sm"><i class="bi bi-arrow-left"
                                style="color: white"></i></button>
                        <span style="font-size:medium;" id="timetableDay" class="pageSubtitleSub">
                            LOADING...
                        </span>
                        <button id="nextDay" class="btn btn-sm"><i class="bi bi-arrow-right"
                                style="color: white"></i></button>
                    </h4>

                    <div id="timetable">

                        <div class="small-box rounded p-3 mb-2" id="timetableLoading">
                            <span class="color-dot bg-primary me-2"></span>
                            <span class="class-name">Loading</span>
                            <div class="teacher-name">Your classes are loading...</div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>



    <!-- Variables -->
    <script>
        const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]; // Days of the Week
        let currentDate = new Date(); // Current Date
        let currentISOString = currentDate.toISOString();
        let unixTimestamp = currentDate.getTime(); // Current UNIX Timestamp
        let unixTimestampInSeconds = Math.floor(unixTimestamp / 1000); // Current UNIX Timestamp in Seconds
        var totalDailyMessages = 0
    </script>


    <!-- Time/Data Updated -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function updateDateAndTime() {
                const today = new Date();

                // Update Date
                const day = String(today.getDate()).padStart(2, '0');
                const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-based
                const year = today.getFullYear();
                const formattedDate = `${day}/${month}/${year}`;
                document.getElementById("currentDate").textContent = formattedDate;
                document.getElementById("todayDate").textContent = formattedDate;

                // Update Time
                let hours = today.getHours();
                const minutes = String(today.getMinutes()).padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';

                // Convert 24-hour time to 12-hour time format
                hours = hours % 12;
                // If hour is 0 (which would be 12 in 24-hour time), set it to 12
                hours = hours ? hours : 12;
                const formattedTime = `${String(hours).padStart(2, '0')}:${minutes} ${ampm}`;
                document.getElementById("currentTime").textContent = formattedTime;
            }

            // Call the function to initialize the display
            updateDateAndTime();

            // Set an interval to update the time every minute
            setInterval(updateDateAndTime, 60 * 1000); // 60 * 1000ms = 1 minute
        });
    </script>


    <!-- Functions -->
    <script>

        function removeColorStyles(htmlString) {
            // Create a new DOM parser
            let parser = new DOMParser();
            let doc = parser.parseFromString(htmlString, 'text/html');

            // Get all elements with style attributes
            let styledElements = doc.querySelectorAll('[style]');

            // Iterate through each element and remove color and background styles
            styledElements.forEach(elem => {
                let styles = elem.getAttribute('style').split(';').filter(style => {
                    return !style.trim().startsWith('color:') &&
                        !style.trim().startsWith('background-color:') &&
                        !style.trim().startsWith('background:');
                });
                elem.setAttribute('style', styles.join(';'));
            });

            // Convert the modified DOM back to an HTML string
            return doc.body.innerHTML;

        }

        function getNextMonday(currentISODate) {
            const currentDate = new Date(currentISODate);
            const dayOfWeek = currentDate.getDay();
            const daysUntilMonday = (8 - dayOfWeek) % 7; // Calculate how many days until Monday
            const nextMonday = new Date(currentDate);
            nextMonday.setDate(currentDate.getDate() + daysUntilMonday);
            return nextMonday.toISOString();
        }


        function convertToAMPM(timeString) {
            // Split the input time string into hours and minutes
            const [hours, minutes] = timeString.split(':');

            // Convert hours to a number
            const hour = parseInt(hours, 10);

            // Determine whether it's AM or PM based on the hour
            const period = hour >= 12 ? 'PM' : 'AM';

            // Convert hours to 12-hour format
            const formattedHour = hour % 12 === 0 ? 12 : hour % 12;

            // Create the formatted time string
            const formattedTime = `${formattedHour}:${minutes}${period}`;

            return formattedTime;
        }

        function removeFirstFourCharacters(inputString) {
            if (inputString.length >= 4) {
                return inputString.substring(4);
            } else {
                // Handle cases where the input string is less than 4 characters
                return "Input string is too short";
            }
        }

        function removeFirstThreeCharacters(inputString) {
            if (inputString.length >= 3) {
                return inputString.substring(3);
            } else {
                // Handle cases where the input string is less than 4 characters
                return "Input string is too short";
            }
        }

        function extractNumberFromString(text) {
            // Use a regular expression to match the number inside the text
            const regex = /(\d+)/;

            // Use the match method to find the first occurrence of the number
            const match = text.match(regex);

            // Check if a match was found
            if (match) {
                // Convert the matched string to a number
                const number = parseInt(match[0]);

                return number;
            }

            // If no match was found, return null or an appropriate value
            return null;
        }

        function countTotalTasks(data) {
            let totalTasks = 0;

            const classes = data.d.ResultTasksStudent;
            for (let i = 0; i < classes.length; i++) {
                totalTasks += classes[i].Tasks.length;
            }

            return totalTasks;
        }
    </script>


    <!-- User Information -->
    <script>
        fetch(`/api/getUserInfo?cookie={{cookie}}`)
            .then(response => response.json())
            .then(data => {
                const yourNameText = document.getElementById('yourName');
                yourNameText.textContent = data.d.name

            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>


    <!-- Timetable -->
    <script>
        function addTimetable(data, weekend) {
            const dataContainer = document.getElementById('timetable');
            const timetableDayText = document.getElementById('timetableDay');
            timetableDayText.textContent = weekend ? 'Weekend' : data.d.Info;

            const periods = data.d.Periods;
            if (weekend && periods.length == 0) {
                const timetableDayText = document.getElementById('timetableDay');
                timetableDayText.textContent = 'Holiday'
                const classDiv = document.createElement('div');
                classDiv.classList.add('small-box', 'rounded', 'p-3', 'mb-2');

                // Create color dot span
                const colorDotSpan = document.createElement('span');
                colorDotSpan.classList.add('color-dot', 'bg-primary', 'me-2');
                classDiv.appendChild(colorDotSpan);

                // Create class name span
                const classNameSpan = document.createElement('span');
                classNameSpan.classList.add('class-name');
                classNameSpan.textContent = "Weekend";
                classDiv.appendChild(classNameSpan);

                // Create teacher div
                const teacherDiv = document.createElement('div');
                teacherDiv.classList.add('teacher-name');
                teacherDiv.textContent = `Enjoy your holiday!`;
                classDiv.appendChild(teacherDiv);

                dataContainer.appendChild(classDiv);
            } else if (weekend) {
                const classDiv = document.createElement('div');
                classDiv.classList.add('small-box', 'rounded', 'p-3', 'mb-2');

                // Create color dot span
                const colorDotSpan = document.createElement('span');
                colorDotSpan.classList.add('color-dot', 'bg-success', 'me-2');
                classDiv.appendChild(colorDotSpan);

                // Create class name span
                const classNameSpan = document.createElement('span');
                classNameSpan.classList.add('class-name');
                classNameSpan.textContent = "Weekend";
                classDiv.appendChild(classNameSpan);

                // Create teacher div
                const teacherDiv = document.createElement('div');
                teacherDiv.classList.add('teacher-name');
                teacherDiv.textContent = `Enjoy your weekend! Here are your classes for Monday.`;
                classDiv.appendChild(teacherDiv);

                dataContainer.appendChild(classDiv);
            } else if (periods.length == 0) {
                const timetableDayText = document.getElementById('timetableDay');
                timetableDayText.textContent = 'Holiday'
                const classDiv = document.createElement('div');
                classDiv.classList.add('small-box', 'rounded', 'p-3', 'mb-2');

                // Create color dot span
                const colorDotSpan = document.createElement('span');
                colorDotSpan.classList.add('color-dot', 'bg-primary', 'me-2');
                classDiv.appendChild(colorDotSpan);

                // Create class name span
                const classNameSpan = document.createElement('span');
                classNameSpan.classList.add('class-name');
                classNameSpan.textContent = "No Classes";
                classDiv.appendChild(classNameSpan);

                // Create teacher div
                const teacherDiv = document.createElement('div');
                teacherDiv.classList.add('teacher-name');
                teacherDiv.textContent = `Enjoy your holiday!`;
                classDiv.appendChild(teacherDiv);

                dataContainer.appendChild(classDiv);
            }


            for (const period of periods) {
                if (period.IsTeachingPeriod) {
                    const classDiv = document.createElement('div');
                    classDiv.classList.add('small-box', 'rounded', 'p-3', 'mb-2');

                    // Create color dot span
                    const colorDotSpan = document.createElement('span');
                    colorDotSpan.classList.add('color-dot', 'bg-primary', 'me-2');
                    classDiv.appendChild(colorDotSpan);

                    // Create class name span
                    const classNameSpan = document.createElement('span');
                    classNameSpan.classList.add('class-name');
                    classNameSpan.textContent = period.Classes[0].TimeTableClass;

                    classNameSpan.setAttribute('data-bs-toggle', 'tooltip');
                    classNameSpan.setAttribute('data-bs-html', 'true');
                    classNameSpan.setAttribute('title', period.Classes[0].Description);


                    classDiv.appendChild(classNameSpan);
                    new bootstrap.Tooltip(classNameSpan);


                    // Create time span
                    const timeSpan = document.createElement('span');
                    timeSpan.classList.add('time');

                    timeSpan.textContent = `${convertToAMPM(period.StartTime)} - ${convertToAMPM(period.EndTime)}`;
                    classDiv.appendChild(timeSpan);

                    // Create teacher div
                    const teacherDiv = document.createElement('div');
                    teacherDiv.classList.add('teacher-name');

                    let teacherName = period.Classes[0].TeacherName;
                    let roomInfo
                    if ("{{ campus }}" == "Beaconsfield") {
                        roomInfo = removeFirstThreeCharacters(period.Classes[0].Room);
                    } else {
                        roomInfo = removeFirstFourCharacters(period.Classes[0].Room);
                    }

                    // Check if the teacherName includes "CRT"
                    if (teacherName.includes("CRT")) {
                        // If it does, set the text content and change the color to red
                        teacherDiv.innerHTML = `${roomInfo} | <span style="color: red;">${teacherName}</span>`;
                    } else {
                        // Otherwise, set the text content without any styling
                        teacherDiv.textContent = `${roomInfo} | ${teacherName}`;
                    }
                    classDiv.appendChild(teacherDiv);

                    // Append the created classDiv to the body or any other parent element
                    dataContainer.appendChild(classDiv);
                }
            }

            const divElement = document.getElementById('timetableLoading');
            divElement.style.display = 'none';


        }
    </script>
    <script>
        currentDate = new Date();

        document.getElementById('prevDay').addEventListener('click', function () {
            currentDate.setDate(currentDate.getDate() - 1);
            fetchTimetable(currentDate);
        });

        document.getElementById('nextDay').addEventListener('click', function () {
            currentDate.setDate(currentDate.getDate() + 1);
            fetchTimetable(currentDate);
        });

        function fetchTimetable(date) {

            document.getElementById('timetable').innerHTML = '';

            const classDiv = document.createElement('div');
            classDiv.classList.add('class', 'rounded', 'p-3', 'mb-2');
            classDiv.id = "timetableLoading"

            const colorDotSpan = document.createElement('span');
            colorDotSpan.classList.add('color-dot', 'bg-primary', 'me-2');
            classDiv.appendChild(colorDotSpan);

            // Create class name span
            const classNameSpan = document.createElement('span');
            classNameSpan.classList.add('class-name');
            classNameSpan.textContent = "Loading";

            classDiv.appendChild(classNameSpan);


            const teacherDiv = document.createElement('div');
            teacherDiv.classList.add('teacher-name');
            teacherDiv.textContent = "Your classes are loading...";

            classDiv.appendChild(teacherDiv);

            const dataContainer = document.getElementById('timetable');
            dataContainer.appendChild(classDiv);

            let dateString = date.toISOString();
            let dayOfWeekNumber = currentDate.getDay();
            let currentDay = daysOfWeek[dayOfWeekNumber]
            let currentISOString = currentDate.toISOString();

            if (currentDay == "Saturday" || currentDay == "Sunday") {
                // Timetable
                fetch(`/api/getTimetable?cookie={{cookie}}&date=${getNextMonday(currentISOString)}`)
                    .then(response => response.json())
                    .then(data => {
                        addTimetable(data, true)
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            } else {

                fetch(`/api/getTimetable?cookie={{cookie}}&date=${currentISOString}`)
                    .then(response => response.json())
                    .then(data => {
                        addTimetable(data, false)

                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }

        }


        fetchTimetable(currentDate);

    </script>







    <script>
        let today = new Date();
        let yyyy = today.getFullYear();
        let mm = String(today.getMonth() + 1).padStart(2, '0');  // January is 0!
        let dd = String(today.getDate()).padStart(2, '0');

        let formattedDate = `${yyyy} ${mm} ${dd}`;

        function isNewMessage(unixTimestamp) {
            newUnix = parseInt(unixTimestamp.replace(/\D/g, ''), 10);

            dateUnix = new Date(newUnix);

            yyyyUnix = dateUnix.getFullYear();
            mmUnix = String(dateUnix.getMonth() + 1).padStart(2, '0');  // January is 0!
            ddUnix = String(dateUnix.getDate()).padStart(2, '0');

            formattedDateUnix = `${yyyyUnix} ${mmUnix} ${ddUnix}`;

            if (formattedDateUnix == formattedDate) {
                return true
            } else {
                return false
            }
        }
    </script>
    <!-- Daily Messages -->
    <script>
        fetch(`/api/getDailyMessages?cookie={{cookie}}&date=${currentISOString}`)
            .then(response => response.json())
            .then(data => {
                const dataContainer = document.getElementById('dailyMessages');

                const periods = data.d.SchoolMessages;

                let musicLessons = localStorage.getItem('musicLessons');

                for (const message of periods) {
                    if (unixTimestampInSeconds < extractNumberFromString(message.StartDateTime)) {

                        if (musicLessons && musicLessons=="Hide") {
                            messageTitle = message.MessageTitle
                            if (messageTitle.toLowerCase().includes('lesson')) {
                                continue
                            }
                        }


                        totalDailyMessages += 1


                        // Create the <h6> element
                        const classDiv = document.createElement('div');
                        classDiv.classList.add('small-box', 'rounded', 'p-3', 'mb-2');

                        if (isNewMessage(message['StartDateTime'])) {
                            // Create color dot span
                            const colorDotSpan = document.createElement('span');
                            colorDotSpan.classList.add('color-dot', 'bg-danger', 'me-2');
                            classDiv.appendChild(colorDotSpan);
                        }

                        const classNameSpan = document.createElement('span');
                        classNameSpan.classList.add('class-name');
                        classNameSpan.textContent = message.MessageTitle;
                        classDiv.appendChild(classNameSpan);

                        const teacherDiv = document.createElement('div');
                        teacherDiv.classList.add('teacher-name');
                        teacherDiv.innerHTML = removeColorStyles(message.MessageContent);
                        classDiv.appendChild(teacherDiv);

                        const timeSpan = document.createElement('span');
                        timeSpan.classList.add('time');
                        timeSpan.textContent = `By: ${message.SubmittedByUserName}`;
                        classDiv.appendChild(timeSpan);

                        dataContainer.appendChild(classDiv);

                    }
                }
                const dailyMessageCountText = document.getElementById('totalDailyMessages');
                dailyMessageCountText.textContent = totalDailyMessages + " Messages"

                const divElement = document.getElementById('dailyMessagesLoading');
                divElement.style.display = 'none';

            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>


    <!-- Weather -->
    <script>
        fetch(`/api/getWeather`)
            .then(response => response.json())
            .then(data => {
                const currentWeather = document.getElementById('currentWeather');
                currentWeather.textContent = data.currentTemp + '¬∞'

                const upcomingWeather = document.getElementById('upcomingWeather');
                upcomingWeather.textContent = data.oneHour + '¬∞ | ' + data.twoHour + '¬∞ | ' + data.threeHour + '¬∞ '

                const weatherInformation = document.getElementById('weatherInformation');
                weatherInformation.textContent = "‚òÄÔ∏è " + convertToAMPM(data.sunrise) + " | üåë " + convertToAMPM(data.sunset) + " | üåßÔ∏è " + data.precipitation + "ml"

                const weatherCampus = document.getElementById('weatherCampus');
                weatherCampus.textContent = data.campus
            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>


    <!-- Classes (Due, Results, Overdue) -->
    <script>
        fetch(`/api/getClasses?cookie={{cookie}}`)
            .then(response => response.json())
            .then(data => {

                // Due
                const dueTasks = document.getElementById('dueTasks');
                const dueContainer = document.getElementById('dueTasksExpand');
                dueTasks.textContent = data.d.DueTasksStudent.length + ' Due'
                for (const task of data.d.DueTasksStudent) {
                    var spanElement = document.createElement('span');
                    spanElement.className = 'ms-2';

                    var boldElement = document.createElement('b');
                    boldElement.textContent = task['TaskTitle'];
                    spanElement.appendChild(boldElement);

                    spanElement.append(` (${task['ClassCode']})`);

                    var brElement = document.createElement('br');
                    spanElement.append(brElement);

                    dueContainer.appendChild(spanElement);
                }

                // Overdue
                const overdueTasks = document.getElementById('overdueTasks');
                const overdueContainer = document.getElementById('overdueTasksExpand');
                overdueTasks.textContent = data.d.OverDueTasksStudent.length + ' Overdue'
                for (const task of data.d.OverDueTasksStudent) {
                    var spanElement = document.createElement('span');
                    spanElement.className = 'ms-2';

                    var boldElement = document.createElement('b');
                    boldElement.textContent = task['TaskTitle'];
                    spanElement.appendChild(boldElement);

                    spanElement.append(` (${task['ClassCode']})`);

                    var brElement = document.createElement('br');
                    spanElement.append(brElement);

                    dueContainer.appendChild(spanElement);
                }

                const resultTasks = document.getElementById('resultTasks');
                const resultContainer = document.getElementById('resultTasksExpand');
                resultTasks.textContent = countTotalTasks(data) + ' Results'

                for (const classF of data.d.ResultTasksStudent) {
                    for (const task of classF.Tasks) {
                        var spanElement = document.createElement('span');
                        spanElement.className = 'ms-2';
    
                        var boldElement = document.createElement('b');
                        boldElement.textContent = task['Title'];
                        spanElement.appendChild(boldElement);
    
                        spanElement.append(` (${task['FinalResult']})`);
    
                        var brElement = document.createElement('br');
                        spanElement.append(brElement);
    
                        resultContainer.appendChild(spanElement);
                    }

                }

            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>


    <!-- Today -->
    <script>
        fetch(`/api/getToday?cookie={{cookie}}`)
            .then(response => response.json())
            .then(data => {
                const dataContainer = document.getElementById('todayActivities');

                const events = data.d.Events;

                if (events.length == 0) {
                    const classDiv = document.createElement('div');
                    classDiv.classList.add('small-box', 'rounded', 'p-3', 'mb-2');


                    // Create class name span
                    const classNameSpan = document.createElement('span');
                    classNameSpan.classList.add('class-name');
                    classNameSpan.textContent = 'Nothing to see here.';
                    classDiv.appendChild(classNameSpan);

                    const teacherDiv = document.createElement('div');
                    teacherDiv.classList.add('teacher-name');
                    teacherDiv.textContent = `You have nothing on today.`;
                    classDiv.appendChild(teacherDiv);


                    // Append the created classDiv to the body or any other parent element
                    dataContainer.appendChild(classDiv);


                }


                for (const event of events) {

                    const classDiv = document.createElement('div');
                    classDiv.classList.add('small-box', 'rounded', 'p-3', 'mb-2');


                    // Create class name span
                    const classNameSpan = document.createElement('span');
                    classNameSpan.classList.add('class-name');
                    classNameSpan.textContent = event.EventTitle;
                    classDiv.appendChild(classNameSpan);


                    // Append the created classDiv to the body or any other parent element
                    dataContainer.appendChild(classDiv);

                }

                const divElement = document.getElementById('timetableLoading');
                divElement.style.display = 'none';


            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>

    <!-- Tooltips -->
    <script>
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    </script>
    <script>
        let setDarkMode = localStorage.getItem('dark');
        if (setDarkMode === 'on') {
            var element = document.body;
            document.documentElement.setAttribute('data-theme', 'dark');
            console.log('Dark mode is on')
        }
    </script>
    <script>
        function toggleTheme() {
            setDarkMode = localStorage.getItem('dark');
            if (setDarkMode !== "on") {
                document.documentElement.setAttribute('data-theme', 'dark');
                // Set the value of the itwm to "on" when dark mode is on
                setDarkMode = localStorage.setItem('dark', 'on');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                // Set the value of the item to  "null" when dark mode if off
                setDarkMode = localStorage.setItem('dark', null);
            }
        }
    </script>

</body>

</html>