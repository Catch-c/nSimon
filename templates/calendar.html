<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar | NSimon {{VERSION}}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/colours.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/base.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/navbar.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/sidebar.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/cards.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/misc.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/profile.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/modal.css') }}" rel="stylesheet" type="text/css">

    <!-- FavIcon -->
    <link href="{{ url_for('static', filename='favicon/apple-touch-icon.png') }}" rel="apple-touch-icon"
        sizes="180x180" />
    <link href="{{ url_for('static', filename='favicon/favicon-32x32.png') }}" rel="icon" sizes="32x32"
        type="image/png" />
    <link href="{{ url_for('static', filename='favicon/favicon-16x16.png') }}" rel="icon" sizes="16x16"
        type="image/png" />
    <link href="{{ url_for('static', filename='favicon/site.webmanifest') }}" rel="manifest" />
    <link color="#5bbad5" href="{{ url_for('static', filename='favicon/safari-pinned-tab.svg') }}" rel="mask-icon" />
    <meta content="#da532c" name="msapplication-TileColor" />
    <meta content="#3a3a3a" name="theme-color" />
</head>

<body>

    <!-- Bootstrap JS & Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>


    {% include "partials/navbar.html" %}


    <!-- Content -->
    <div class="container-fluid main-content">



        <div class="row mb-2">

            <!-- Calendar Day Selection  -->
            <div class="col-12 col-sm-12 col-custom">

                <div class="card card-custom-calendartop">

                    <div class="card-header">

                        <h5 class="mb-0">
                            <span class="cardTitle">Calendar</span>
                            <span class="cardSubtitle">
                                <button id="prevDay" class="btn btn-sm"><i class="bi bi-arrow-left"></i></button>

                                <span style="font-size:medium;" id="calendarWeek">Loading</span>

                                <button id="nextDay" class="btn btn-sm"><i class="bi bi-arrow-right"></i></button>

                            </span>
                        </h5>

                    </div>


                </div>


            </div>

        </div>

        <!-- Days (Monday -> Thursday) -->
        <div class="row mb-1">

            <!-- Monday -->
            <div class="col-12 col-sm-3 col-custom">

                <div class="card card-custom-calendar-day">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Monday</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body" id="MondayHolder">



                    </div>

                </div>


            </div>

            <!-- Tuesday -->
            <div class="col-12 col-sm-3 col-custom">

                <div class="card card-custom-calendar-day">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Tuesday</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body" id="TuesdayHolder">



                    </div>

                </div>


            </div>

            <!-- Wednesday -->
            <div class="col-12 col-sm-3 col-custom">

                <div class="card card-custom-calendar-day">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Wednesday</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body" id="WednesdayHolder">



                    </div>

                </div>


            </div>

            <!-- Thursday -->
            <div class="col-12 col-sm-3 col-custom">

                <div class="card card-custom-calendar-day">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Thursday</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body" id="ThursdayHolder">



                    </div>

                </div>


            </div>
        </div>

        <!-- Days (Friday -> Sunday)-->
        <div class="row">

            <!-- Friday -->
            <div class="col-12 col-sm-3 col-custom">

                <div class="card card-custom-calendar-day">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Friday</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body" id="FridayHolder">



                    </div>

                </div>


            </div>

            <!-- Saturday -->
            <div class="col-12 col-sm-3 col-custom">

                <div class="card card-custom-calendar-day">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Saturday</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body" id="SaturdayHolder">



                    </div>

                </div>


            </div>

            <!-- Sunday -->
            <div class="col-12 col-sm-3 col-custom">

                <div class="card card-custom-calendar-day">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Sunday</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body" id="SundayHolder">



                    </div>

                </div>


            </div>

        </div>

    </div>


    <!-- Functions -->
    <script>
        function getCookie(cookieName) {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.startsWith(cookieName + '=')) {
                    return cookie.substring(cookieName.length + 1);
                }
            }
            return null;
        }

        const authCookie = getCookie('adAuthCookie');
        const campus = getCookie('campus');

        if (authCookie == null) {
            window.location.href = '/logout';
        }

        if (campus == null) {
            window.location.href = '/logout';
        }

        function getFirstTwoDecimalPlacesAsWholeNumber(num) {
            let result = Math.round(num * 100);
            return result;
        }


    </script>

    <script>
        function getLastSaturday() {
            const today = new Date();
            const dayOfWeek = today.getDay();

            let daysToSubtract;
            if (dayOfWeek === 6) {
                daysToSubtract = 7;
            } else {
                daysToSubtract = dayOfWeek + 1;
            }

            today.setDate(today.getDate() - daysToSubtract);

            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');

            return `${year}-${month}-${day}`;
        }

        function addSevenDays() {
            const [year, month, day] = dateToGet.split('-').map(Number);
            const dateObj = new Date(year, month - 1, day);
            dateObj.setDate(dateObj.getDate() + 7);

            const newYear = dateObj.getFullYear();
            const newMonth = String(dateObj.getMonth() + 1).padStart(2, '0');
            const newDay = String(dateObj.getDate()).padStart(2, '0');

            return `${newYear}-${newMonth}-${newDay}`;
        }

        function removeSevenDays() {
            const [year, month, day] = dateToGet.split('-').map(Number);
            const dateObj = new Date(year, month - 1, day);
            dateObj.setDate(dateObj.getDate() - 7);

            const newYear = dateObj.getFullYear();
            const newMonth = String(dateObj.getMonth() + 1).padStart(2, '0');
            const newDay = String(dateObj.getDate()).padStart(2, '0');

            return `${newYear}-${newMonth}-${newDay}`;
        }

        function getClosestMonday() {
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

            const [year, month, day] = dateToGet.split('-').map(Number);
            const dateObj = new Date(year, month - 1, day);

            const dayOfWeek = dateObj.getDay();

            let daysToAdjust;
            if (dayOfWeek === 0) {
                daysToAdjust = 1;
            } else if (dayOfWeek === 1) {
                daysToAdjust = 0;
            } else {
                daysToAdjust = dayOfWeek <= 4 ? - (dayOfWeek - 1) : 8 - dayOfWeek;
            }

            dateObj.setDate(dateObj.getDate() + daysToAdjust);

            const newYear = dateObj.getFullYear();
            const newMonth = monthNames[dateObj.getMonth()];
            const newDay = dateObj.getDate();

            return `${newDay} ${newMonth} ${newYear}`;
        }



    </script>
    <script>
        function getCalendar(dateA) {
            document.getElementById('MondayHolder').innerHTML = '';
            document.getElementById('TuesdayHolder').innerHTML = '';
            document.getElementById('WednesdayHolder').innerHTML = '';
            document.getElementById('ThursdayHolder').innerHTML = '';
            document.getElementById('FridayHolder').innerHTML = '';
            document.getElementById('SaturdayHolder').innerHTML = '';
            document.getElementById('SundayHolder').innerHTML = '';

            let data = {
                date: dateA
            };

            fetch(`/api/getCalendar`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('calendarWeek').textContent = `${getClosestMonday(dateA)} Week`
                    for (const event of data.d.events) {
                        if (event['CalendarType'] != "TypeLearning") {
                            const timestamp = parseInt(event['StartTime'].match(/\/Date\((\d+)\)\//)[1]);

                            const date = new Date(timestamp);
                            const startHour = String(date.getHours()).padStart(2, '0');
                            const startMinute = String(date.getMinutes()).padStart(2, '0');


                            const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

                            const dayName = days[date.getDay()];

                            const timestampEnd = parseInt(event['EndTime'].match(/\/Date\((\d+)\)\//)[1]);

                            const dateEnd = new Date(timestampEnd);
                            const endHour = String(dateEnd.getHours()).padStart(2, '0');
                            const endMinute = String(dateEnd.getMinutes()).padStart(2, '0');

                            const eventHolder = document.getElementById(`${dayName}Holder`);

                            const classDiv = document.createElement('div');
                            classDiv.classList.add('box', 'rounded');

                            if (dayName == "Monday") {
                                const colorDotSpan = document.createElement('span');
                                colorDotSpan.classList.add('color-dot', 'bg-primary', 'me-2');
                                classDiv.appendChild(colorDotSpan);
                            } else if (dayName == "Tuesday") {
                                const colorDotSpan = document.createElement('span');
                                colorDotSpan.classList.add('color-dot', 'bg-info', 'me-2');
                                classDiv.appendChild(colorDotSpan);
                            } else if (dayName == "Wednesday") {
                                const colorDotSpan = document.createElement('span');
                                colorDotSpan.classList.add('color-dot', 'bg-success', 'me-2');
                                classDiv.appendChild(colorDotSpan);
                            } else if (dayName == "Thursday") {
                                const colorDotSpan = document.createElement('span');
                                colorDotSpan.classList.add('color-dot', 'bg-warning', 'me-2');
                                classDiv.appendChild(colorDotSpan);
                            } else if (dayName == "Friday") {
                                const colorDotSpan = document.createElement('span');
                                colorDotSpan.classList.add('color-dot', 'bg-danger', 'me-2');
                                classDiv.appendChild(colorDotSpan);
                            } else if (dayName == "Saturday") {
                                const colorDotSpan = document.createElement('span');
                                colorDotSpan.classList.add('color-dot', 'bg-primary', 'me-2');
                                classDiv.appendChild(colorDotSpan);
                            } else if (dayName == "Sunday") {
                                const colorDotSpan = document.createElement('span');
                                colorDotSpan.classList.add('color-dot', 'bg-info', 'me-2');
                                classDiv.appendChild(colorDotSpan);
                            }

                            var strongElement = document.createElement("strong");
                            strongElement.textContent = `${event['EventTitle']} | `;
                            classDiv.appendChild(strongElement);


                            var spanElement = document.createElement("span");
                            spanElement.innerHTML = `${startHour}:${startMinute} - ${endHour}:${endMinute}`;
                            classDiv.appendChild(spanElement);

                            eventHolder.appendChild(classDiv);
                        }
                    }
                    document.getElementById('prevDay').disabled = false
                    document.getElementById('nextDay').disabled = false

                    if (document.getElementById('MondayHolder').innerHTML == '') {
                        const classDiv = document.createElement('div');
                        classDiv.classList.add('box', 'rounded');

                        var strongElement = document.createElement("strong");
                        strongElement.textContent = "No Events";
                        classDiv.appendChild(strongElement);

                        document.getElementById('MondayHolder').appendChild(classDiv);
                    }

                    if (document.getElementById('TuesdayHolder').innerHTML == '') {
                        const classDiv = document.createElement('div');
                        classDiv.classList.add('box', 'rounded');

                        var strongElement = document.createElement("strong");
                        strongElement.textContent = "No Events";
                        classDiv.appendChild(strongElement);

                        document.getElementById('TuesdayHolder').appendChild(classDiv);
                    }

                    if (document.getElementById('WednesdayHolder').innerHTML == '') {
                        const classDiv = document.createElement('div');
                        classDiv.classList.add('box', 'rounded');

                        var strongElement = document.createElement("strong");
                        strongElement.textContent = "No Events";
                        classDiv.appendChild(strongElement);

                        document.getElementById('WednesdayHolder').appendChild(classDiv);
                    }

                    if (document.getElementById('ThursdayHolder').innerHTML == '') {
                        const classDiv = document.createElement('div');
                        classDiv.classList.add('box', 'rounded');

                        var strongElement = document.createElement("strong");
                        strongElement.textContent = "No Events";
                        classDiv.appendChild(strongElement);

                        document.getElementById('ThursdayHolder').appendChild(classDiv);
                    }

                    if (document.getElementById('FridayHolder').innerHTML == '') {
                        const classDiv = document.createElement('div');
                        classDiv.classList.add('box', 'rounded');

                        var strongElement = document.createElement("strong");
                        strongElement.textContent = "No Events";
                        classDiv.appendChild(strongElement);

                        document.getElementById('FridayHolder').appendChild(classDiv);
                    }

                    if (document.getElementById('SaturdayHolder').innerHTML == '') {
                        const classDiv = document.createElement('div');
                        classDiv.classList.add('box', 'rounded');

                        var strongElement = document.createElement("strong");
                        strongElement.textContent = "No Events";
                        classDiv.appendChild(strongElement);

                        document.getElementById('SaturdayHolder').appendChild(classDiv);
                    }

                    if (document.getElementById('SundayHolder').innerHTML == '') {
                        const classDiv = document.createElement('div');
                        classDiv.classList.add('box', 'rounded');

                        var strongElement = document.createElement("strong");
                        strongElement.textContent = "No Events";
                        classDiv.appendChild(strongElement);

                        document.getElementById('SundayHolder').appendChild(classDiv);
                    }

                })
                .catch(error => {
                    console.error('Error:', error);
                });


        }
    </script>
    <script>
        let dateToGet = getLastSaturday()
        getCalendar(dateToGet)

        document.getElementById('prevDay').addEventListener('click', function () {

            document.getElementById('prevDay').disabled = true
            document.getElementById('nextDay').disabled = true
            dateToGet = removeSevenDays()
            getCalendar(dateToGet);
        });

        document.getElementById('nextDay').addEventListener('click', function () {
            document.getElementById('prevDay').disabled = true
            document.getElementById('nextDay').disabled = true
            dateToGet = addSevenDays()
            getCalendar(dateToGet);
        });

    </script>
    {% include "partials/themes.html" %}




</body>

</html>