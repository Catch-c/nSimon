<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile | NSimon {{VERSION}}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/colours.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/base.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/navbar.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/sidebar.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/cards.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/misc.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/profile.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/modal.css') }}" rel="stylesheet" type="text/css">

    <!-- FavIcon -->
    <link href="{{ url_for('static', filename='favicon/apple-touch-icon.png') }}" rel="apple-touch-icon"
        sizes="180x180" />
    <link href="{{ url_for('static', filename='favicon/favicon-32x32.png') }}" rel="icon" sizes="32x32"
        type="image/png" />
    <link href="{{ url_for('static', filename='favicon/favicon-16x16.png') }}" rel="icon" sizes="16x16"
        type="image/png" />
    <link href="{{ url_for('static', filename='favicon/site.webmanifest') }}" rel="manifest" />
    <link color="#5bbad5" href="{{ url_for('static', filename='favicon/safari-pinned-tab.svg') }}" rel="mask-icon" />
    <meta content="#da532c" name="msapplication-TileColor" />
    <meta content="#3a3a3a" name="theme-color" />

</head>

<body>

    <!-- Bootstrap JS & Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <!-- Modals -->

    <!-- Attendence Modals -->
    <div>
        <!-- PNAs -->
        <div class="modal fade" id="absencesModal" tabindex="-1" aria-labelledby="absencesModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="absencesModalLabel">Parent Notified Absences</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="absencesModalHolder">



                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Late to School -->
        <div class="modal fade" id="lateModal" tabindex="-1" aria-labelledby="lateModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="lateModalLabel">Late to School</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="box rounded">
                            <strong>Coming Soon</strong>
                        </div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leave Passes -->
        <div class="modal fade" id="leaveModal" tabindex="-1" aria-labelledby="leaveModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="leaveModalLabel">Leave Passes</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="box rounded">
                            <strong>Coming Soon</strong>
                        </div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sick Passes -->
        <div class="modal fade" id="sickModal" tabindex="-1" aria-labelledby="sickModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="sickModalLabel">Sick Passes</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="box rounded">
                            <strong>Coming Soon</strong>
                        </div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <!-- Commendation Modals -->
    <div>
        <!-- Full List -->
        <div class="modal fade" id="commendationsModal" tabindex="-1" aria-labelledby="commendationsModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="commendationsModalLabel">Commendations</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="commendationHolder">



                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Single -->
        <div class="modal fade" id="commendationModal" tabindex="-1" aria-labelledby="commendationModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="commendationModalLabel"></h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="box rounded">
                            <strong>Category:</strong>
                            <span id="commendationCategory">Leadership in Community and Culture </span>
                        </div>
                        <div class="box rounded">
                            <strong>Awarded By:</strong>
                            <span id="commendationAwarder">Sharpe, Michelle</span>
                        </div>
                        <div class="box rounded">
                            <strong>Awarded On:</strong>
                            <span id="commendationDate">25 Oct 2023</span>
                        </div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Back</button>
                    </div>
                </div>
            </div>
        </div>
        <script>
            var profileCommendationModal = new bootstrap.Modal(document.getElementById('commendationModal'), {})

            function openCommendation(title, category, awarder, date) {
                document.getElementById('commendationModalLabel').textContent = title
                document.getElementById('commendationCategory').textContent = category
                document.getElementById('commendationAwarder').textContent = awarder
                document.getElementById('commendationDate').textContent = date
                profileCommendationModal.show()
            };
        </script>
    </div>

    <!-- Report Modal -->
    <div class="modal fade" id="reportsModal" tabindex="-1" aria-labelledby="reportsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="reportsModalLabel">Reports</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="box rounded">
                        <strong>Coming Soon</strong>
                    </div>



                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Activities Modal -->
    <div class="modal fade" id="activitiesModal" tabindex="-1" aria-labelledby="activitiesModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="activitiesModalLabel">Upcoming Activities</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="box rounded">
                        <strong>Coming Soon</strong>
                    </div>



                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Parents Modal -->
    <div class="modal fade" id="parentsModal" tabindex="-1" aria-labelledby="parentsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="parentsModalLabel">Parents</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="parentsModalHolder">




                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    {% include "partials/navbar.html" %}


    <!-- Content -->
    <div class="container-fluid main-content">



        <div class="row mb-1">

            <!-- Picture -->
            <div class="col-12 col-sm-2 col-custom">

                <div class="card card-custom-general">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Picture</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body">
                        <div class="box rounded">
                            <img id="studentImage" src="./image.jpg"
                                style="border-radius: 10%; min-width: 90px; width: 90px; ">
                        </div>
                    </div>

                </div>


            </div>

            <!-- General Information -->

            <div class="col-12 col-sm-10 col-custom">


                <div class="card card-custom-general">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">General Information</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body">
                        <div class="box rounded">
                            <strong id="profileName">
                                Loading
                            </strong>
                            <br>
                            Student ID: <span id="profileStudentID">Loading</span>
                            <br>
                            Year Level: <span id="profileYearLevel">Loading</span>
                            <br>
                            House: <span id="profileHouse">Loading</span>
                        </div>
                    </div>

                </div>


            </div>
        </div>

        <div class="row">

            <!-- Attendance -->
            <div class="col-12 col-sm-3 col-custom">

                <div class="card card-custom-attendence">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Attendance</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body">
                        <div class="box rounded">
                            <div class="progress">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 100%;"
                                    aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" id="attendenceProgress">
                                    Loading
                                </div>
                            </div>
                        </div>

                        <!-- PNAs -->
                        <div class="box rounded box-button" id="profileAbsencesButton">
                            <strong>Parent Notified Absences:</strong>
                            <span id="profileAbsences">Loading</span>
                        </div>

                        <script>
                            var profileAbsencesModal = new bootstrap.Modal(document.getElementById('absencesModal'), {})

                            document.getElementById("profileAbsencesButton").addEventListener("click", function () {
                                profileAbsencesModal.show()
                            });
                        </script>


                        <!-- Late to school -->
                        <div class="box rounded box-button" id="profileLateButton">
                            <strong>Late to School:</strong>
                            <span id="profileLatetoSchool">Loading</span>
                        </div>

                        <script>
                            var profileLateModal = new bootstrap.Modal(document.getElementById('lateModal'), {})

                            document.getElementById("profileLateButton").addEventListener("click", function () {
                                profileLateModal.show()
                            });
                        </script>


                        <!-- Leave Passes -->
                        <div class="box rounded box-button" id="profileLeaveButton">
                            <strong>Leave Passes:</strong>
                            <span id="profileLeavePasses">Loading</span>
                        </div>

                        <script>
                            var profileLeaveModal = new bootstrap.Modal(document.getElementById('leaveModal'), {})

                            document.getElementById("profileLeaveButton").addEventListener("click", function () {
                                profileLeaveModal.show()
                            });
                        </script>


                        <!-- Sick Passes -->
                        <div class="box rounded box-button" id="profileSickButton">
                            <strong>Sick Passes:</strong>
                            <span id="profileSickPasses">Loading</span>
                        </div>

                        <script>
                            var profileSickModal = new bootstrap.Modal(document.getElementById('sickModal'), {})

                            document.getElementById("profileSickButton").addEventListener("click", function () {
                                profileSickModal.show()
                            });
                        </script>
                    </div>

                </div>


            </div>

            <!-- Commendations -->
            <div class="col-12 col-sm-3 col-custom">

                <div class="card card-custom-attendence">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Commendations</strong>
                            <small class="cardSubtitle text-button" id="profileCommendationButton">View</small>

                            <script>
                                var profileCommendationsModal = new bootstrap.Modal(document.getElementById('commendationsModal'), {})

                                document.getElementById("profileCommendationButton").addEventListener("click", function () {
                                    profileCommendationsModal.show()
                                });
                            </script>

                        </h5>
                    </div>

                    <div class="card-body">

                        <div class="box rounded">
                            <strong>Total:</strong>
                            <span id="profileCommendationsTotal">Loading</span>
                        </div>

                        <div class="box rounded">
                            <strong>Community and Culture:</strong>
                            <span id="profileCommendationsCommunityCulture">??</span>
                        </div>

                        <div class="box rounded">
                            <strong>Learning Partnerships:</strong>
                            <span id="profileCommendationsLearningPartnerships">??</span>
                        </div>

                        <div class="box rounded">
                            <strong>Learning:</strong>
                            <span id="profileCommendationsLearning">??</span>
                        </div>

                        <div class="box rounded">
                            <strong>Faith & Service:</strong>
                            <span id="profileCommendationsFaithService">??</span>
                        </div>
                    </div>

                </div>


            </div>

            <!-- Other -->
            <div class="col-12 col-sm-6 col-custom">

                <div class="card card-custom-attendence">

                    <div class="card-header">
                        <h5 class="mb-0">
                            <strong class="cardTitle">Other</strong>
                            <small class="cardSubtitle"></small>
                        </h5>
                    </div>

                    <div class="card-body">

                        <!-- Reports -->
                        <div class="box rounded box-button" id="profileReportsButton">
                            <strong>Reports:</strong>
                            <span id="profileReports">Loading</span>
                        </div>

                        <script>
                            var profileReportsModal = new bootstrap.Modal(document.getElementById('reportsModal'), {})

                            document.getElementById("profileReportsButton").addEventListener("click", function () {
                                profileReportsModal.show()
                            });
                        </script>


                        <!-- Activities -->
                        <div class="box rounded box-button" id="profileActivitiesButton">
                            <strong>Upcoming Activities:</strong>
                            <span id="profileActivities">Coming Soon</span>
                        </div>

                        <script>
                            var profileActivitiesModal = new bootstrap.Modal(document.getElementById('activitiesModal'), {})

                            document.getElementById("profileActivitiesButton").addEventListener("click", function () {
                                profileActivitiesModal.show()
                            });
                        </script>


                        <!-- Parents -->
                        <div class="box rounded box-button" id="profileParentsButton">
                            <strong>Parents:</strong>
                            <span id="profileParents">Loading</span>
                        </div>

                        <script>
                            var profileParentsModal = new bootstrap.Modal(document.getElementById('parentsModal'), {})

                            document.getElementById("profileParentsButton").addEventListener("click", function () {
                                profileParentsModal.show()
                            });
                        </script>


                    </div>

                </div>


            </div>



        </div>

    </div>


    <!-- Functions -->
    <script>
        function getCookie(cookieName) {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.startsWith(cookieName + '=')) {
                    return cookie.substring(cookieName.length + 1);
                }
            }
            return null;
        }

        const authCookie = getCookie('adAuthCookie');
        const campus = getCookie('campus');

        if (authCookie == null) {
            window.location.href = '/logout';
        }

        if (campus == null) {
            window.location.href = '/logout';
        }

        function getFirstTwoDecimalPlacesAsWholeNumber(num) {
            let result = Math.round(num * 100);
            return result;
        }


    </script>

    <!-- Attendence -->
    <script>

        fetch(`/api/getDashboardData`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
        })
            .then(response => response.json())
            .then(data => {

                // ATTENDENCE
                element = document.getElementById('profileAbsences');
                element.innerText = data['d']['SemesterBasedData'][0]['ParentNotifiedAbsences'].length;
                for (const absence of data['d']['SemesterBasedData'][0]['ParentNotifiedAbsences']) {
                    var divElement = document.createElement("div");
                    divElement.classList.add("box", "rounded");

                    var strongElement = document.createElement("strong");
                    var dateString = absence.RollDate;
                    var timestamp = dateString.match(/\d+/)[0];
                    var date = new Date(parseInt(timestamp));

                    var day = date.getDate().toString().padStart(2, '0');
                    var month = (date.getMonth() + 1).toString().padStart(2, '0');
                    var year = date.getFullYear();
                    strongElement.textContent = `${day}/${month}/${year}: `;

                    var spanElement = document.createElement("span");
                    spanElement.textContent = absence.Reason;

                    divElement.appendChild(strongElement);
                    divElement.appendChild(spanElement);

                    document.getElementById('absencesModalHolder').appendChild(divElement);


                }

                element = document.getElementById('profileLatetoSchool');
                element.innerText = data['d']['SemesterBasedData'][0]['LateToSchool'].length;

                element = document.getElementById('profileLeavePasses');
                element.innerText = data['d']['SemesterBasedData'][0]['LeavePass'].length;

                element = document.getElementById('profileSickPasses');
                element.innerText = data['d']['SemesterBasedData'][0]['SickPasses'].length;


                attendance = getFirstTwoDecimalPlacesAsWholeNumber(data['d']['SemesterBasedData'][0]['AttendancePercentage'])
                element = document.getElementById('attendenceProgress');
                element.style.width = `${attendance}%`;
                element.setAttribute("aria-valuenow", attendance);
                element.classList.remove("bg-success");
                element.classList.add("bg-danger");

                if (attendance > 79.9) {
                    element.classList.remove("bg-danger");
                    element.classList.add("bg-warning");
                } else if (attendance > 89.9) {
                    element.classList.remove("bg-danger");
                    element.classList.add("bg-success");
                }


                element.innerText = `${attendance}%`


                // Parent Accounts
                element = document.getElementById('profileParents');
                element.innerText = data['d']['ParentLoginAccountData']['ParentLogins'].length;

                for (const parent of data['d']['ParentLoginAccountData']['ParentLogins']) {
                    var divElement = document.createElement("div");
                    divElement.classList.add("box", "rounded");

                    var strongElement = document.createElement("strong");
                    strongElement.textContent = `${parent['FullName']}`;



                    divElement.appendChild(strongElement);

                    document.getElementById('parentsModalHolder').appendChild(divElement);


                }

                // Reports
                element = document.getElementById('profileReports');
                element.innerText = data['d']['AssessmentReports'];

            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>

    <!-- Profile Details -->
    <script>

        fetch(`/api/getStudentProfileDetails`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
        })
            .then(response => response.json())
            .then(data => {


                // GENERAL INFO

                let element = document.getElementById('profileName');
                element.textContent = `${data['d']['FullName']}`

                element = document.getElementById('profileStudentID');
                element.innerText = `Student ID: ${data['d']['UID']}`

                element = document.getElementById('profileHouse');
                element.innerText = `House: ${data['d']['HouseDescription']}`

                element = document.getElementById('profileYearLevel');
                element.innerText = `Year Level: ${data['d']['YearLevelCode']}`






            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>

    <!-- Student Image -->
    <script>
        fetch("/api/getStudentProfileImage", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.blob();
            })
            .then(blob => {
                const imageUrl = URL.createObjectURL(blob);
                const studentImage = document.getElementById("studentImage");
                studentImage.src = imageUrl;
            })
            .catch(error => {
                console.error("Error:", error);
                const studentImage = document.getElementById("studentImage");
                studentImage.src = "path_to_placeholder_image.jpg";
            });
    </script>

    <!-- Commendations -->
    <script>
        fetch(`/api/getCommendations`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
        })
            .then(response => response.json())
            .then(data => {

                let element = document.getElementById('profileCommendationsTotal');
                element.textContent = `${data['d']['Total']}`

                let container = document.getElementById('commendationHolder');


                data.d.Data.forEach((item) => {

                    var divElement = document.createElement("div");
                    divElement.classList.add("box", "rounded", "box-button");

                    var strongElement = document.createElement("strong");
                    var dateString = item.CommendationDate;
                    var timestamp = dateString.match(/\d+/)[0];
                    var date = new Date(parseInt(timestamp));

                    var day = date.getDate().toString().padStart(2, '0');
                    var month = (date.getMonth() + 1).toString().padStart(2, '0');
                    var year = date.getFullYear();
                    strongElement.textContent = `${day}/${month}/${year}: `;

                    var spanElement = document.createElement("span");
                    spanElement.textContent = item.CommendationTitle;

                    divElement.appendChild(strongElement);
                    divElement.appendChild(spanElement);

                    divElement.addEventListener('click', function () {
                        openCommendation(item.CommendationTitle, item.CategoryDescription, item.ReportedBy, `${day}/${month}/${year}`)
                    });

                    container.appendChild(divElement);



                });

            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>
    {% include "partials/themes.html" %}




</body>

</html>